
/** POSITION TYPE */
create table PositionType (
id bigint generated by default as identity,
active boolean not null,
businessKey varchar(255) not null,
custom boolean not null,
description varchar(255),
version timestamp,
typeLevel integer not null,
primary key (id)
);

/** POSITION */
create table Position (
id bigint generated by default as identity,
active boolean not null,
businessKey varchar(255) not null,
custom boolean not null,
description varchar(255),
version timestamp,
parentId bigint,
orgUnit_id bigint,
type_id bigint,
primary key (id)
);

/** UNIT-TYPE */
create table UnitType (
id bigint generated by default as identity,
active boolean not null,
businessKey varchar(255) not null,
custom boolean not null,
description varchar(255),
version timestamp,
primary key (id)
);

/** ORG UNIT */
create table OrgUnit (
id bigint generated by default as identity,
active boolean not null,
businessKey varchar(255) not null,
custom boolean not null,
description varchar(255),
version timestamp,
parentId bigint,
managerPosition_id bigint,
type_id bigint,
primary key (id)
);

/** The Positions Mangaged by an ORG UNIT */
create table OrgUnit_Position (
OrgUnitEntity_id bigint not null,
positions_id bigint not null,
primary key (OrgUnitEntity_id, positions_id)
);


/** The ORG UNITS Managed by a Position */
create table Position_OrgUnit (
PositionEntity_id bigint not null,
manageOrgUnits_id bigint not null,
primary key (PositionEntity_id, manageOrgUnits_id)
);

/** LOCATIONs */
create table Location (
id bigint generated by default as identity,
active boolean not null,
businessKey varchar(255) not null,
custom boolean not null,
description varchar(255),
version timestamp,
country varchar(255),
line1 varchar(255),
line2 varchar(255),
postcode varchar(255),
state varchar(255),
suburb varchar(255),
workStation varchar(255),
parentId bigint,
primary key (id)
);

/** IMAGE HOLDER */
create table Image (
id bigint generated by default as identity,
active boolean not null,
businessKey varchar(255) not null,
custom boolean not null,
description varchar(255),
version timestamp,
image blob,
mimeType varchar(255),
thumbNail blob,
primary key (id)
);

/** CHANNEL (ie email, mobile etc) */
create table Channel (
id bigint generated by default as identity,
active boolean not null,
businessKey varchar(255) not null,
custom boolean not null,
description varchar(255),
version timestamp,
channelValue varchar(255),
type varchar(255),
primary key (id)
);

/** CONTACT (ie the Person) */
create table Contact (
id bigint generated by default as identity,
active boolean not null,
businessKey varchar(255) not null,
custom boolean not null,
description varchar(255),
version timestamp,
country varchar(255),
line1 varchar(255),
line2 varchar(255),
postcode varchar(255),
state varchar(255),
suburb varchar(255),
workStation varchar(255),
companyTitle varchar(255),
firstName varchar(255),
lastName varchar(255),
image_id bigint,
location_id bigint,
primary key (id)
);

/** Contacts can have multiple channels */
create table Contact_Channel (
ContactEntity_id bigint not null,
channels_id bigint not null,
primary key (ContactEntity_id, channels_id)
);

/** Contacts can manage multiple positions */
create table Contact_Position (
ContactEntity_id bigint not null,
positions_id bigint not null,
primary key (ContactEntity_id, positions_id)
);

/** Position can be managed by mulitple contacts */
create table Position_Contact (
PositionEntity_id bigint not null,
contacts_id bigint not null,
primary key (PositionEntity_id, contacts_id)
);


alter table Position add constraint FK_Position_to_Position foreign key (parentId) references Position;
alter table Position add constraint FK_Position_to_PositionType foreign key (type_id) references PositionType;
alter table Position add constraint FK_Position_to_OrgUnit foreign key (orgUnit_id) references OrgUnit;
alter table OrgUnit add constraint FK_OrgUnit_to_Type foreign key (type_id) references UnitType;
alter table OrgUnit add constraint FK_OrgUnit_to_OrgUnit foreign key (parentId) references OrgUnit;
alter table OrgUnit add constraint FK_OrgUnit_to_ManagerPosition foreign key (managerPosition_id) references Position;
alter table OrgUnit_Position add constraint UK_OrgUnit_Position unique (positions_id);
alter table OrgUnit_Position add constraint FK_OrgUnit_Position_to_Position foreign key (positions_id) references Position;
alter table OrgUnit_Position add constraint FK_OrgUnit_Position_to_OrgUnit foreign key (OrgUnitEntity_id) references OrgUnit;
alter table Position_OrgUnit add constraint UK_Position_OrgUnit unique (manageOrgUnits_id);
alter table Position_OrgUnit add constraint FK_Position_OrgUnit_to_OrgUnit foreign key (manageOrgUnits_id) references OrgUnit;
alter table Position_OrgUnit add constraint FK_Position_OrgUnit_to_Position foreign key (PositionEntity_id) references Position;
alter table Location add constraint FK_Location_to_Location foreign key (parentId) references Location;
alter table Contact add constraint FK_Contact_to_Location foreign key (location_id) references Location;
alter table Contact add constraint FK_Contact_to_Image foreign key (image_id) references Image;
alter table Contact_Channel add constraint UK_Contact_Channel unique (channels_id);
alter table Contact_Channel add constraint FK_Contact_Channel_to_Channel foreign key (channels_id) references Channel;
alter table Contact_Channel add constraint FK_Contact_Channel_to_Contact foreign key (ContactEntity_id) references Contact;
alter table Contact_Position add constraint FK_Contact_Position_to_Contact foreign key (ContactEntity_id) references Contact;
alter table Contact_Position add constraint FK_Contact_Position_to_Position foreign key (positions_id) references Position;
alter table Position_Contact add constraint FK_Position_Contact_to_Contact foreign key (contacts_id) references Contact;
alter table Position_Contact add constraint FK_Position_Contact_to_Position foreign key (PositionEntity_id) references Position;


alter table PositionType add constraint UK_PositionType_Business_Key unique (businessKey);
alter table Position add constraint UK_Position_Business_Key unique (businessKey);
alter table OrgUnit add constraint UK_OrgUnit_Business_Key unique (businessKey);
alter table Location add constraint UK_Location_Business_Key unique (businessKey);
alter table Contact add constraint UK_Contact_Business_Key unique (businessKey);
alter table UnitType add constraint UK_UnitType_Business_Key unique (businessKey);
alter table Channel add constraint UK_Channel_Business_Key unique (businessKey);
alter table Image add constraint UK_Image_Business_Key unique (businessKey);
